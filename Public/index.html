<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ACS Warranty Claim</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f4f5f7;
  margin: 0;
}
.container {
  max-width: 600px;
  margin: 2rem auto;
  background: #fff;
  padding: 1.5rem;
  border-radius: 10px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}
label { font-weight: 600; display:block; margin-top:.75rem; }
input, textarea, select {
  width:100%;
  padding:.5rem;
  margin-top:.25rem;
}
button {
  background:#0b8457;
  color:#fff;
  border:none;
  padding:.6rem .9rem;
  cursor:pointer;
}
.row {
  display:flex;
  gap:8px;
  align-items:center;
}
.locked {
  background:#f0f0f0;
}
</style>
</head>

<body>
<div class="container">

<div style="text-align:center;margin-bottom:1rem;">
  <img src="/logo.png" style="max-width:260px;width:100%;">
</div>

<h2 style="text-align:center;margin-top:0;">Warranty Claim</h2>

<form id="warranty-form">

<label>Customer Name *</label>
<input name="customerName" required>

<label>Email *</label>
<input type="email" name="customerEmail" required>

<label>Phone</label>
<input name="customerPhone">

<label>Source *</label>
<select name="source" required>
<option value="">Select</option>
<option>Shopify</option>
<option>eBay</option>
<option>Walk-in</option>
<option>Other</option>
</select>

<label>Original Order # *</label>
<div class="row">
  <input name="originalOrderNumber" id="order" required>
  <button type="button" id="lookup-btn">Lookup</button>
</div>

<label>Original Warranty #</label>
<input name="originalWarrantyNumber">

<label>Product *</label>
<input name="product" required>

<label>UPC</label>
<input name="upc">

<label>Issue *</label>
<textarea name="issueDescription" required></textarea>

<label>Address</label>
<textarea name="customerAddress"></textarea>

<label>Notes</label>
<textarea name="notes"></textarea>

<button type="submit" style="margin-top:1rem;width:100%;">
Submit Warranty
</button>

</form>
</div>

<script>
const API_BASE = "https://acs-warranty-api.onrender.com";

/* ================= LOOKUP ================= */
document.getElementById("lookup-btn").onclick = async () => {
  const order = document.getElementById("order").value.trim();
  if (!order) return alert("Enter Order #");

  const res = await fetch(`${API_BASE}/warranty/lookup?order=` + encodeURIComponent(order));
  const data = await res.json();

  if (data.status !== "ok" || !data.matches.length) {
    alert("No match found");
    return;
  }

  const m = data.matches[0];
  const form = document.getElementById("warranty-form");

  form.customerName.value = m.customerName || "";
  form.customerEmail.value = m.customerEmail || "";
  form.customerPhone.value = m.customerPhone || "";
  form.source.value = m.source || "";
  form.originalWarrantyNumber.value = m.originalWarrantyNumber || "";
  form.product.value = m.product || "";
  form.upc.value = m.upc || "";
  form.issueDescription.value = m.issueDescription || "";
  form.customerAddress.value = m.customerAddress || "";

  lockField(form.customerName);
  lockField(form.customerEmail);
  lockField(form.customerPhone);
  lockField(form.source);
  lockField(form.originalWarrantyNumber);
  lockField(form.product);
  lockField(form.upc);

  alert("Order found and loaded ✅");
};

function lockField(field){
  field.readOnly = true;
  field.classList.add("locked");
}

/* ================= SUBMIT ================= */
document.getElementById("warranty-form").addEventListener("submit", async e => {
  e.preventDefault();

  const payload = Object.fromEntries(new FormData(e.target).entries());

  const res = await fetch(`${API_BASE}/warranty`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  });

  const data = await res.json();

  if (data.status === "ok") {
    alert("Warranty submitted successfully ✅");
    e.target.reset();
  } else {
    alert("Submission failed ❌");
  }
});
</script>

</body>
</html>
