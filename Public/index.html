<script>
document.getElementById("warranty-form").addEventListener("submit", async function (e) {
  e.preventDefault();

  const form = e.target; // ✅ define FIRST

  console.log("UPC SENT:", form.upc.value); // now safe

  const payload = {
    source: form.source.value,
    customerName: form.customerName.value,
    customerEmail: form.customerEmail.value,
    customerPhone: form.customerPhone.value || "",
    originalOrderNumber: form.originalOrderNumber.value,
    originalWarrantyNumber: form.originalWarrantyNumber.value || "",
    product: form.product.value,
    upc: form.upc.value || "",   // ✅ UPC INCLUDED
    issueDescription: form.issueDescription.value,
    customerAddress: form.customerAddress.value || "",
    notes: form.notes.value || ""
  };

  try {
    const res = await fetch("https://acs-warranty-api.onrender.com/warranty", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) throw new Error("Submit failed");

    alert("Warranty submitted successfully.");
    form.reset();

  } catch (err) {
    console.error(err);
    alert("Submission failed. Please try again.");
  }
});
</script>
